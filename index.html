<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>AynÄ± Anda, AynÄ± Yerde</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- FIREBASE (DOÄRU YER: HEAD) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCW9YMZh0C3yQHMZG6PjFVgiKlKETxV7xM",
    authDomain: "evsann.firebaseapp.com",
    databaseURL: "https://evsann-default-rtdb.firebaseio.com",
    projectId: "evsann",
    storageBucket: "evsann.appspot.com",
    messagingSenderId: "1013708332512",
    appId: "1:1013708332512:web:33d58945364546c3341f85"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<style>
body{
  margin:0;
  background:#000;
  color:#eee;
  font-family:Arial,sans-serif;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.screen{display:none;text-align:center;max-width:500px;}
.screen.active{display:block;}
button{padding:14px 22px;margin:8px;font-size:18px;}
input{padding:10px;font-size:16px}
.timer{font-size:24px;margin-top:15px;}
</style>
</head>

<body>

<div id="lobby" class="screen active">
  <h1>AynÄ± Anda, AynÄ± Yerde</h1>
  <button onclick="createRoom()">Oda OluÅŸtur</button><br><br>
  <input id="roomInput" placeholder="Oda Kodu">
  <button onclick="joinRoom()">Odaya KatÄ±l</button>
</div>

<div id="room" class="screen">
  <h2>Oda</h2>
  <p>Kod: <b id="roomCode"></b></p>
  <p>DiÄŸer kiÅŸi bekleniyorâ€¦</p>
</div>

<div id="chapter" class="screen">
  <h2>Sessizlik</h2>
  <p>Kelimeler yok. Sadece hisler kaldÄ±.</p>
  <button onclick="choose('close')">ğŸ™‚</button>
  <button onclick="choose('neutral')">ğŸ˜</button>
  <button onclick="choose('away')">ğŸ™</button>
  <div class="timer" id="timer">8</div>
</div>

<div id="lost" class="screen">
  <h2>BaÄŸlantÄ± koptu</h2>
</div>

<script>
let roomId;
let playerId = Math.random().toString(36).substr(2,9);
let timerInt;

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function createRoom(){
  roomId = Math.random().toString(36).substr(2,5).toUpperCase();
  db.ref("rooms/"+roomId).set({
    players:{[playerId]:true}
  });
  enterRoom();
}

function joinRoom(){
  roomId = roomInput.value.trim().toUpperCase();
  db.ref("rooms/"+roomId).once("value",snap=>{
    if(!snap.exists()){
      alert("Oda yok");
      return;
    }
    db.ref("rooms/"+roomId+"/players/"+playerId).set(true);
    enterRoom();
  });
}

function enterRoom(){
  show("room");
  roomCode.innerText = roomId;

  const ref = db.ref("rooms/"+roomId);
  ref.on("value",snap=>{
    if(!snap.exists()) return show("lost");
    const players = Object.keys(snap.val().players||{}).length;
    if(players===2){
      startChapter();
    }
  });

  db.ref("rooms/"+roomId+"/players/"+playerId).onDisconnect().remove();
}

function startChapter(){
  show("chapter");
  let t=8;
  timer.innerText=t;
  timerInt=setInterval(()=>{
    t--;
    timer.innerText=t;
    if(t<=0){
      clearInterval(timerInt);
      alert("Bitti.");
    }
  },1000);
}

function choose(v){
  clearInterval(timerInt);
  alert("SeÃ§imin alÄ±ndÄ±.");
}
</script>

</body>
</html>
